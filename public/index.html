<!DOCTYPE html>
<html>
  <head>
    <title>Ruby on Rails: Welcome aboard</title>
  </head>
  <body>

    <div class="local">
      <video style="height: 500px; width: 500px;" autoplay></video>
    </div>
    <div class="remote">
      <video style="height: 500px; width: 500px;" autoplay></video>
    </div>

    <button>Llamar</button>


    <script>

      var pc,
          servers = {"iceServers": [{"url": "stun:stun.l.google.com:19302"}]};

      navigator.webkitGetUserMedia({ video: true }, onSuccess);

      function onSuccess (stream) {
        window.stream = stream;
        document.querySelector('.local video').src = URL.createObjectURL(stream);
      }

      document.querySelector('button').onClick = call;

      function call() {
        if (!!window.stream) {
          pc = new webkitRTCPeerConnection(servers);
          pc.onicecandidate = onIceCandidate;
          pc.onaddstream = onAddStream;
          pc.addStream(stream);
          pc.createOffer(onGetLocalDescription);
        }
      }

      function onIceCandidate(a, b, c) {
        console.log(a);
        console.log(b);
        console.log(c);
      }

      function onAddStream(remoteStream) {
        document.querySelector('.remote video').src = URL.createObjectURL(stream);
      }

      function onGetLocalDescription(localDescription) {
        console.log(localDescription);
        pc.setLocalDescription(localDescription);
      }
    </script>


  </body>
</html>
